---
title: 'A Study of Metabolic Rate'
author: "Your name"
output: html_document
---

```{r}
library(ggplot2)
```

### Introduction

We examine the relationship between metabolic rate and mass using a small data set collected by Kleiber in 1947. Kleiber measured the metabolic rate and mass of 19 animals (mouse, dog, cat, goat, man, cow, elephant, ...).

We read Kleiber's results into *R* with
```{r}
animals = read.table("../data/KleiberData.txt", header = TRUE)
head(animals)
```


## Exploration

We confirm that there are measurements on 19 animals 

```{r}
dim(animals)
```

The data frame does not indicate the units of measurement. 
Metabolic rate is in kilo-calories per day, i.e. kcal/day, and
mass is in kilograms.


We examine the relationship between mass and metabolic rate with a scatter plot. 

```{r}
ggplot(animals, aes(x = Mass, y = MR)) +
  geom_point() 
```

With highly skewed data or data with a few large values, it 
can be difficult to see the relationship between the variables.
Additionally, many statistical techniques rely on distributions
being roughly symmetric. 

We make another plot of the data using log scales for both variables. 

```{r}
ggplot(animals, aes(x = Mass, y = MR)) +
  geom_point() +  scale_x_log10() + scale_y_log10()
```

From the second plot on the log-log scale, a linear relationship is evident.

## Fitting a simple linear model

We fit a simple linear model for metabolic rate and examine
the coefficient for mass. A physical model for the relationship between these two variables is based on the following relationships between mass and volume and metabolic rate and surface area:

$$ mass \propto radius^3$$
$$ metabolic~rate \propto radius^2$$
Hence,
$$ metabolic~rate \propto mass^{2/3}$$

```{r}
lm(log(MR) ~ log(Mass), data = animals)
```

We see that the slope of mass is nearly 3/4, not 2/3. Could this be spurious? In other words, what if the true line does have a slope of  2/3 and the slope that we observed was just due to randomness in generating the points that form our sample? We will use a bootstrapping process to help address this question.
 

## Bootstrapping the animals

We can simulate new samples by random sampling with replacement from the original sample, as many times as the original sample size. Each of these new samples will give us a scatter plot and a simple linear regression. We will call these the bootstrapped scatter plot and regression line.

Let's take one bootstrap sample and examine the scatter plot and regression line.

We first deterimine which pairs of metabolic rate and mass to include in the bootstrap sample.  The `sample()` function has a shorthand way of doing this:

```{r}
sample(19, replace = TRUE)
```

Run the above code chunk a few times and look for repeated observations in the sample. 

We use the ransom indices to create the bootstrap sample with:

```{r}
bootInd = sample(19, replace = TRUE)
bootSamp = animals[bootInd, ]
```

The scatter plot of the bootstrap sample looks similar to the original scatter plot of the sample. 

```{r}
ggplot(bootSamp, aes(x = Mass, y = MR)) +
  geom_point() +  scale_x_log10() + scale_y_log10()
```


Next, we fit the regression line to the bootstrap sample and examine
the coefficient for the slope.
```{r}
lm(log(MR) ~ log(Mass), data = bootSamp)
```

### Approximate the bootstrap distribution

Replicate the bootstrap procedure 2,000 times and save the coefficient for the slope:
```{r}
bootSlopes = replicate(2000, {
  bootInd = sample(19, replace = TRUE)
  bootSamp = animals[bootInd, ]
  lm(log(MR) ~ log(Mass), data = bootSamp)$coefficients[2]
})
```

We approximate the sampling distribution of the bootstrapped slope with our 2,000 replicates. The histogram appears below. 

```{r}
ggplot(data = data.frame(bootSlopes), aes(x = bootSlopes)) +
  geom_histogram(aes(y = ..density..), 
                 color="black", fill = "grey", alpha = 0.4)
```

## Could the true slope be 2/3?

To decide whether or not the slope actually is 2/3, we test the following hypothesis:

**Null Hypothesis** The slope of the true line is 2/3.

**Alternative Hypothesis** The slope of the true line is not 2/3.

To test this hypothesis, we can construct a 95% confidence interval for the true slope using the bootstrap percentile method. Then, we determine whether the interval contains 2/3.  If it doesn't, then we reject the null hypothesis (with the 5% cutoff for the p-value). If the confidence interval for the true slope does contain 2/3, then we don't have enough evidence to reject the null hypothesis. 

The confidence interval extends from the 2.5th percentile to the 97.5th percentile of the 2000 bootstrapped slopes.

```{r}
quantile(bootSlopes, probs = c(0.025, 0.975))
```

Our interval does not contain 2/3 so we reject the hypothesis that the true slope is 2/3.

### Caveats
The bimodal distribution of the bootstrapped slopes indicates that we may not have enough data to be carrying out the bootstrap.


### More recent findings
Kleiber's rule was studied by Clarke in 2010.
Clarke had hundreds of animals and found the slope of the regression of
log metabolic rate on log mass to be 0.75.


